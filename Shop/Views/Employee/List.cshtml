@{
    ViewData["Title"] = "Список сотрудников";
}

<h2>Список</h2>

<div>
    <h4>Сотрудников</h4>
</div>

<table class="table">
    <thead>
        <tr>
            <th>
                Имя
            </th>
            <th>
                Фамилия
            </th>
            <th>
                Номер телефона
            </th>
            <th>
                Должность
            </th>
        </tr>
    </thead>

    <tbody id="list" />
</table>

<script>
    function getContext(controller, action) {
            return fetch("/" + controller + "/" + action);
        }

    function postContext(controller, action, body) {
        return fetch("/" + controller + "/" + action, {
            method: "Post",
            headers: {
                "Content-Type": "application/json"
            },
            body: body
        });
    }

    function ready(callback) {
        if (document.readyState != "loading") callback();
        else document.addEventListener("DOMContentLoaded", callback);
    }
    ready(getEmployees);

    function getEmployees() {
        getContext("Employee", "GetEmployees")
            .then(response => response.json())
            .then(function (commits) {
                if (commits != 0 && commits != null) {
                    commits.forEach(element => unpackingEmployees(element));
                }
                else {
                    unpackingEmployees();
               }
            });
    }

    function unpackingEmployees(element) {
        if (element == undefined) {
            element = { firstName: "Null", lastName: "Null", phoneNumber: "Null", position: "Null" };
        }
        var tr = document.createElement("tr");

        var th = document.createElement("th");
        th.textContent = element.firstName;
        tr.appendChild(th);

        th = document.createElement("th");
        th.textContent = element.lastName;
        tr.appendChild(th);

        th = document.createElement("th");
        th.textContent = element.phoneNumber;
        tr.appendChild(th);

        th = document.createElement("th");
        th.textContent = element.position;
        tr.appendChild(th);
        
        list.appendChild(tr);
    }
</script>